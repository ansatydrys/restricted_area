# Архитектурные решения

## Основные принципы

- **Чистая архитектура** — доменные сущности (`src/core`) отделены от инфраструктуры (YOLO, OpenCV).
- **KISS & DRY** — минималистичная реализация, повторно используемые компоненты вынесены в отдельные модули.
- **Расширяемость** — сервисы и контроллеры можно подменять или наращивать (например, добавить DeepSORT).

## Выбор библиотек

- `ultralytics` — актуальная реализация YOLOv8 с простым API для детекции и трекинга (ByteTrack).
- `opencv-python` — отрисовка, взаимодействие с видео, а также инструменты для геометрии (проверка попадания в полигон).
- `numpy` — работа с координатами, подготовка контуров для OpenCV.

## Зоны

- Хранятся в JSON (`data/restricted_zones.json`) для прозрачности и простоты редактирования.
- `ZoneRepository` инкапсулирует сохранение/загрузку; точки записываются в пикселях кадра.
- Проверка проникновения выполняется через `cv2.pointPolygonTest`, что избавляет от внешних зависимостей.

## Сигнал тревоги

- `AlarmController` управляет состоянием тревоги, используется `time.monotonic` для устойчивости к изменению системного времени.
- При отсутствии людей в зоне тревога автоматически отключается через 3 секунды.

## Отрисовка

- Модуль `src/presentation/overlay.py` концентрирует всю визуализацию, что упрощает тестирование и поддержку.
- Нарушители подсвечиваются красным цветом, что облегчает визуальную оценку ситуации.

## Возможности расширения

- **Идентификация**: можно подключить DeepSORT, изменив сервис детекции так, чтобы он поставлял ID из внешнего трекера.
- **Несколько зон**: `ZoneRepository` уже поддерживает список зон; достаточно доработать UI и главный цикл.
- **Логирование/оповещения**: логика тревоги выделена, что позволяет легко добавить запись в лог или отправку в систему оповещения.



