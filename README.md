# Restricted Area Intrusion Detection

Система для обнаружения проникновения людей в запрещённую зону на основе модели YOLO и OpenCV.

## Возможности

- Выделение запрещённой зоны на кадре видео с сохранением координат в `data/restricted_zones.json`.
- Детекция людей с помощью YOLOv8 и подсветка проникших в зону объектов.
- Сигнал тревоги (`ALARM!`) при попадании человека в зону и авто-отключение через 3 секунды после исчезновения.
- Поддержка трекинга (ByteTrack) для стабильных идентификаторов объектов.

## Требования

- Python 3.11+
- ОС с поддержкой OpenCV (проверено на macOS).
- Тестовое видео `test.mp4` в корне проекта.

## Установка

```bash
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install --upgrade pip
pip install -r requirements.txt
```

При первом запуске модель YOLO будет загружена автоматически библиотекой `ultralytics`.

## Разметка запрещённой зоны

```bash
python -m src.scripts.annotate_zone --video test.mp4
```

- ЛКМ — добавить точку полигона.
- `u` — удалить последнюю точку.
- `c` — очистить все точки.
- `s` или `Enter` — сохранить зону.
- `q` или `Esc` — выйти без сохранения.

Координаты сохраняются в `data/restricted_zones.json` и будут использованы основным приложением.

## Запуск мониторинга

```bash
python -m src.app --video test.mp4
```

Дополнительные параметры:

- `--model` — путь или имя модели YOLO (по умолчанию `yolov8n.pt`).
- `--conf` — порог уверенности (по умолчанию `0.4`).
- `--no-tracking` — отключить трекинг (идентификаторы объектов не гарантируются).

Управление окном: `q` или `Esc` — выход.

## Структура проекта

- `src/` — исходный код.
  - `config/` — настройки приложения.
  - `core/` — доменные сущности и бизнес-логика.
  - `services/` — интеграция с YOLO.
  - `presentation/` — отрисовка интерфейса.
  - `scripts/` — вспомогательные скрипты (разметка зон).
- `data/restricted_zones.json` — сохранённые зоны.
- `docs/TECH_DECISIONS.md` — архитектурные заметки.

## Тестовый сценарий

1. Разметьте зону на кадре видео.
2. Запустите мониторинг.
3. Наблюдайте подсветку проникших в зону людей и сигнал тревоги.

## Дополнительно

- Для GPU-ускорения установите `torch` и `torchvision` с поддержкой вашей видеокарты до установки `ultralytics`.
- Файл `docs/TECH_DECISIONS.md` содержит детали по архитектуре и выбранным решениям.
